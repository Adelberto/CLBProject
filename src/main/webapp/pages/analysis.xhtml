<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="template/ui.xhtml">
	<ui:define name="body">
		<ui:include src="./general/menutab.xhtml" />
		<div class="analysisDiv">
			<h:form id="analysisForm">
				<p:spacer height="20" />
				<table width="100%" class="analysisDivClass" cellpadding="5">
					<tr>
						<td width="175px" align="left" class="analysisDivClassMainCell"><h:outputLabel
								value="Analysis Menu"></h:outputLabel>
							<hr /></td>
						<td align="right">
								 <b><p:outputLabel
									value="Date:" for="scaleList"></p:outputLabel></b>
								 <p:spacer width="5"/>
								<p:calendar 
								value="#{analysisBean.analysisDate}" label="Date:" maxdate="#{analysisBean.todayDate}"
								pattern="dd-MM-yyyy" styleClass="timeFrame">
								<p:ajax event="dateSelect"
									listener="#{analysisBean.analysisCalendarSelect}"
									update=":analysisForm"></p:ajax>
								</p:calendar> <p:spacer
								width="30"></p:spacer> 
								<b><p:outputLabel rendered="#{analysisBean.scaleGraphic == 'HOUR'}"
									value="Hour:" for="scaleList"></p:outputLabel></b>
								<p:spacer width="5" rendered="#{analysisBean.scaleGraphic == 'HOUR'}" />
								<p:selectOneMenu id="hourList" rendered="#{analysisBean.scaleGraphic == 'HOUR'}"
								widgetVar="hourList" value="#{analysisBean.hour}">
								<p:ajax event="change"
									listener="#{analysisBean.updateScaleValues}"
									update=":analysisForm"></p:ajax>
								<f:selectItems value="#{analysisBean.hoursValues}"
									var="hour" itemValue="#{hour}"
									itemLabel="#{hour.label}" />
							</p:selectOneMenu>
								<p:spacer rendered="#{analysisBean.scaleGraphic == 'HOUR'}"
								width="30" />
								<b><p:outputLabel rendered="#{analysisBean.scaleGraphic == 'MONTH'}"
									value="Month:" for="scaleList"></p:outputLabel></b>
								<p:spacer width="5" rendered="#{analysisBean.scaleGraphic == 'MONTH'}" />
								<p:selectOneMenu id="monthsList" rendered="#{analysisBean.scaleGraphic == 'MONTH'}"
								widgetVar="monthsList" value="#{analysisBean.month}">
								<f:selectItems value="#{analysisBean.monthsValues}"
									var="month" itemValue="#{month}"
									itemLabel="#{month.label}" />
							</p:selectOneMenu>
								<p:spacer rendered="#{analysisBean.scaleGraphic == 'MONTH'}"
								width="30" />
								<b><p:outputLabel
									value="Scale:" for="scaleList"></p:outputLabel></b> <p:spacer
								width="5"></p:spacer> <p:selectOneMenu id="scaleList"
								widgetVar="scaleList" value="#{analysisBean.scaleGraphic}">
								<p:ajax event="change"
									listener="#{analysisBean.updateScaleValues}"
									update=":analysisForm"></p:ajax>
								<f:selectItems value="#{analysisBean.scalesGraphic}"
									var="analysisScale" itemValue="#{analysisScale}"
									itemLabel="#{analysisScale.label}" />
							</p:selectOneMenu></td>
					</tr>
					<tr>
						<td valign="top" width="175px"><p:selectOneMenu
								styleClass="selectOneMenuAnalysis"
								value="#{analysisBean.analysisType}">
								<f:selectItems value="#{analysisBean.analysisTypes}"
									var="analysisTyp" itemValue="#{analysisTyp}"
									itemLabel="#{analysisTyp.label}" />
							</p:selectOneMenu> <p:spacer height="20"></p:spacer> <p:panel>
								<div align="center">
									<c:choose>
										<c:when test="#{empty analysisBean.buildingSelected}">
											<p:outputLabel value="No Buildings to Select"></p:outputLabel>
										</c:when>
										<c:otherwise>
											<b><p:outputLabel value="Building"></p:outputLabel></b>
											<hr />
											<p:graphicImage width="150px"
												styleClass="buildingImgAnalysis"
												value="#{request.contextPath}/../resources/images/buildings/#{analysisBean.buildingSelected.imgPath}" />
											<br />
											<p:outputLabel styleClass="analysisPanelTitle"
												value="#{analysisBean.buildingSelected.name}"></p:outputLabel>
											<br />
											<br />
											<p:commandButton value="Change"
												oncomplete="PF('selectionPopupBuilding').show()" ajax="true"
												icon="fa fa-fw fa-building" styleClass="simpleButton" />
										</c:otherwise>
									</c:choose>
								</div>
							</p:panel> <p:spacer height="5" /> <p:panel>
								<div align="center">
									<c:choose>
										<c:when
											test="#{empty analysisBean.buildingSelected.buildingMeters}">
											<p:outputLabel value="No Meters to Select"></p:outputLabel>
										</c:when>
										<c:otherwise>
											<b><p:outputLabel value="Meters"></p:outputLabel></b>
											<hr />
											<div align="left">
												<h:panelGrid columns="2" cellpadding="2">
													<c:forEach
														items="#{analysisBean.buildingSelected.buildingMeters}"
														var="buildingMeter">
														<p:column>
															<p:selectBooleanCheckbox
																value="#{analysisBean.analysisDayPojo.lineSeriesAvilableBuldingParamatersMap[buildingMeter.labelKey]}">
																<p:ajax update="@form"
																	listener="#{analysisBean.updateMeterSelection(buildingMeter)}" />
															</p:selectBooleanCheckbox>
														</p:column>
														<p:column>
															<h:outputText value="#{buildingMeter.name}"
																styleClass="accPanelMeters"></h:outputText>
														</p:column>
													</c:forEach>
												</h:panelGrid>
											</div>
										</c:otherwise>
									</c:choose>
								</div>
							</p:panel></td>
						<td valign="top" align="center"><p:panel
								styleClass="chartPanel">
								<p:outputLabel styleClass="analysisTitle"
									value="#{analysisBean.analyzerSelected.name}"></p:outputLabel>
								<br />
								<p:commandLink value="Change" style="font-size: 10px"
									oncomplete="PF('selectionPopupAnalyzer').show()" />
								<p:chart styleClass="analysisChartCSS" id="chartDayId"
									responsive="true" widgetVar="chartDayId"
									model="#{analysisBean.analysisDayPojo.lineModel}" type="line" />
							</p:panel></td>
					</tr>
				</table>
			</h:form>
		</div>
		<ui:include src="./general/footer.xhtml" />
		<ui:include src="./popups/selectionPopupBuilding.xhtml" />
		<ui:include src="./popups/selectionPopupAnalyzer.xhtml" />
	</ui:define>
</ui:composition>